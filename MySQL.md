# MySQL

## explain

重点关注type

常用的类型有：all、index、range、ref、eq_ref、const、system（从左到右，性能从差到好）

| 类型   | 描述                                                 |
| ------ | ---------------------------------------------------- |
| all    | 全表扫描                                             |
| index  | 全索引扫描                                           |
| range  | 使用索引范围查询                                     |
| ref    | 非唯一索引等值查询                                   |
| eq_ref | 多表连接中主键、唯一索引等值查询                     |
| const  | 主键置于where列表中，MySQL就能将该查询转换为一个常量 |
| system | 数据表只有一行，const的特例                          |

## MVCC

参考链接

[正确理解MySQL的MVCC实现原理](https://blog.csdn.net/SnailMann/article/details/94724197)

多版本并发控制是一种用来解决`读写冲突`的无锁并发控制，为事务分配单向增长的`时间戳`，为每个修改保持一个版本，版本与事务时间戳相关，读操作只读该事务开始前的数据库的快照。

`解决问题`

* 1、在并发读写数据库时，可以做到在读操作时不用阻塞写操作，写操作也不用阻塞读操作，提高了数据库并发读写性能；
* 2、同时还可以解决脏读、幻读、不可重复读等事务隔离问题，但是不能解决更新丢失问题。

## 主从复制

### 原理

* MySQL主库在事务提交时会把数据变成事件记录在二进制日志Binlog中；
* 主库推送二进制日志文件Binlog中的事件到从库的中继日志Relay Log中，之后从库根据中继日志重做数据变更操作，通过逻辑复制来达到主库与从库的数据一致性；
* MySQL通过三个线程来完成主从库间的数据复制，其中Binglog Dump线程跑在主库上，I/O线程和SQL线程跑在从库上；
* 当在从库上启动复制时，首先建立I/O线程连接主库，主库随后创建Binglog Dump线程读取数据库事件并发送给I/O线程，I/O线程获取到事件数据后更新到从库中继日志Relay Log中去，之后从库上的SQL线程读取中继日志Relay Log中更新的数据事件并应用。

![MySQL_master_slave](img\MySQL_master_slave.webp)

## 存储结构

### B树

![Btree](img\Btree.webp)

`特点：`

* 1、B树节点中存储着多个元素，每个内节点有多个分叉；
* 2、节点中的元素包含键值和数据，节点中的键值从大到小排列，也就是说，在所有的节点都存储着数据。
* 3、父节点当中的元素不会出现在子节点中。
* 4、所有的叶子节点都位于同一层，叶节点具有相同的深度，叶节点之间没有指针连接。

`缺点：`

* 1、B数不支持范围查询的快速查找，如果查询10到35之间的数据，查找到15之后，需要回到根节点重新遍历查找，需要从根节点进行多次遍历。
* 2、如果data存储的是行记录，行的大小随着列数的增加，所占空间会变大，这时一个页中可存储的数据量就会变少，树相应就会变高，磁盘IO次数就会变大。

### B+树

B+树和B树最主要的区别在于非叶子节点是否存储数据的问题。

* B树：非叶子节点和叶子节点都会存储数据库。

* B+树：只有叶子节点才会存储数据，非叶子节点只存储键值。叶子节点直接使用双向指针连接，最底层的叶子节点形成了一个双向有序链表。

  ![B+tree](img\B+tree.webp)

## Change Buffer

参考链接

[change buffer 唯一索引和普通索引](https://blog.csdn.net/qq_39787367/article/details/103823327)